# Copyright (C) Inverse inc.
global
  external-check
  user haproxy
	group haproxy
	daemon
	pidfile %%var_dir%%/run/haproxy-db.pid
	log /dev/log local0 notice
	stats socket %%var_dir%%/run/haproxy-db.stats level admin process 1
	maxconn 4000

listen stats
  bind  %%management_ip%%:1026
  mode http
  timeout connect 10s
  timeout client 1m
  timeout server 1m
  stats enable
  stats uri /stats
  stats realm HAProxy\ Statistics
  stats auth admin:packetfence


defaults
	log	global
	mode	http
	option	httplog
	option	dontlognull
        timeout connect 5000
        timeout client 50000
        timeout server 50000
        errorfile 403 %%captiveportal_templates_path%%/rate-limiting.http

%%management_ip_frontend%%

frontend  main
    bind 127.0.0.1:3306
    mode tcp
    option tcplog
    default_backend             mysql

backend mysql
    mode tcp
    option tcplog
    #option httpchk
    #default-server port 3307 inter 2s downinter 5s rise 3 fall 2 slowstart 60s maxconn 64 maxqueue 128 weight 100
    timeout connect 3s
%%mysql_backend%%

